<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Wishlist - EcomStore</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <%- include('partials/header') %>
  
  <main class="wishlist-page">
    <div class="container">
      <h1>My Wishlist</h1>
      
      <% if (!wishlist.items || wishlist.items.length === 0) { %>
        <div class="empty-state">
          <p>Your wishlist is empty</p>
          <a href="/" class="btn btn-primary">Browse Products</a>
        </div>
      <% } else { %>
        <div class="wishlist-grid">
          <% wishlist.items.forEach(item => { %>
            <div class="wishlist-card">
              <button class="btn-remove-wishlist" onclick="removeFromWishlist('<%= item.productId %>')">Ã—</button>
              <a href="/products/<%= item.productId %>">
                <img src="<%= item.imageUrl %>" alt="<%= item.productName %>">
              </a>
              <div class="wishlist-info">
                <h3><a href="/products/<%= item.productId %>"><%= item.productName %></a></h3>
                <p class="wishlist-price">$<%= item.price.toFixed(2) %></p>
                <div class="wishlist-actions">
                  <button onclick="moveToCart('<%= item.productId %>')" class="btn btn-primary">Move to Cart</button>
                  <button onclick="addToCart('<%= item.productId %>')" class="btn btn-secondary">Add to Cart</button>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>
  </main>
  
  <%- include('partials/footer') %>
  
  <script>
    async function removeFromWishlist(productId) {
      try {
        const response = await fetch('/wishlist/remove', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ productId })
        });
        const data = await response.json();
        if (data.success) {
          showToast('Removed from wishlist');
          location.reload();
        }
      } catch (error) {
        showToast('Failed to remove from wishlist', 'error');
      }
    }
    
    async function moveToCart(productId) {
      try {
        const response = await fetch('/wishlist/move-to-cart', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ productId })
        });
        const data = await response.json();
        if (data.success) {
          showToast('Moved to cart!');
          location.reload();
        }
      } catch (error) {
        showToast('Failed to move to cart', 'error');
      }
    }
    
    async function addToCart(productId) {
      try {
        const response = await fetch('/cart/add', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ productId, quantity: 1 })
        });
        const data = await response.json();
        if (data.success) {
          showToast('Added to cart!');
        }
      } catch (error) {
        showToast('Failed to add to cart', 'error');
      }
    }
  </script>
</body>
</html>
